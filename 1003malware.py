import re
import magic
import zipfile
import os
import requests
def extractzip(zip_file_path,dest_path):
    zip_ref = zipfile.ZipFile(zip_file_path, 'r')
    zip_ref.extractall(dest_path,pwd='infected')
    name_list = zip_ref.namelist()
    zip_ref.close()
    return name_list
def det_filetype(filepath):

    ft= magic.from_file(filepath)
    return ft
def deletemal(hashv):
    os.remove(hashv)
def virustotal_infos(hash_val):
    #get info from virustotal according to hash value
    url = 'https://www.virustotal.com/#/file/3cc5871bf954c043acddda4b9ebcaf893519b191266df8f3deba5f2b6f0d0fc0/detection'
    r = requests.post(url)
    print r.content
#def interfile():
    #interfile malwares according to year
    

path ="/home/mert/Genel/python_codes/"
malzip = path+"VirusShare_d650552bc9e86d433978043088f24644.zip"
namlist= extractzip(malzip,path)
ftype = det_filetype(path+namlist[0])

unwanted_types = ['HTML']
for utyp in unwanted_types:
    if utyp in ftype:
        deletemal(path+namlist[0])
        print("everything is ok deleted file:", path+namlist[0])
        virustotal_infos(namlist[0])
